# PDF Field Extraction Configuration
# This file defines what fields to extract and how to find them
# Modify this file to adapt to different PDF layouts without code changes

# Global extraction settings
settings:
  # Confidence threshold (0.0 - 1.0) below which a field is considered uncertain
  confidence_threshold: 0.6
  
  # Whether to attempt OCR on pages with little/no extractable text
  auto_ocr_fallback: true
  
  # Minimum text characters per page before triggering OCR
  ocr_text_threshold: 50
  
  # Date formats to try when parsing dates (in order of preference)
  date_formats:
    - "%Y-%m-%d"
    - "%d/%m/%Y"
    - "%m/%d/%Y"
    - "%d-%m-%Y"
    - "%B %d, %Y"
    - "%b %d, %Y"
    - "%d %B %Y"
    - "%d %b %Y"
  
  # Currency symbols to recognize
  currency_symbols:
    - "$"
    - "€"
    - "£"
    - "¥"
    - "₹"
    - "USD"
    - "EUR"
    - "GBP"

# Field definitions
# Each field has:
#   - name: internal field name (used in CSV output)
#   - display_name: human-readable name
#   - type: string, number, currency, date, text_block
#   - required: whether extraction failure should be flagged
#   - patterns: list of regex patterns to try (in order)
#   - keywords: contextual keywords that appear near the field
#   - multiline: whether field can span multiple lines
#   - validation: optional validation rules

fields:
  - name: invoice_number
    display_name: "Invoice Number"
    type: string
    required: true
    patterns:
      - '(?i)invoice\s*(?:#|no\.?|number)?[:\s]*([A-Z0-9][-A-Z0-9]{2,20})'
      - '(?i)inv[:\s]*([A-Z0-9][-A-Z0-9]{2,20})'
      - '(?i)bill\s*(?:#|no\.?)?[:\s]*([A-Z0-9][-A-Z0-9]{2,20})'
      - '(?i)reference[:\s]*([A-Z0-9][-A-Z0-9]{2,20})'
    keywords:
      - "invoice"
      - "inv"
      - "bill"
      - "reference"
    multiline: false
    validation:
      min_length: 3
      max_length: 30

  - name: invoice_date
    display_name: "Invoice Date"
    type: date
    required: true
    patterns:
      - '(?i)(?:invoice\s*)?date[:\s]*(\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4})'
      - '(?i)(?:invoice\s*)?date[:\s]*(\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2})'
      - '(?i)(?:invoice\s*)?date[:\s]*([A-Za-z]+\s+\d{1,2},?\s+\d{4})'
      - '(?i)(?:invoice\s*)?date[:\s]*(\d{1,2}\s+[A-Za-z]+\s+\d{4})'
      - '(?i)dated?[:\s]*(\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4})'
    keywords:
      - "date"
      - "dated"
      - "invoice date"
    multiline: false

  - name: due_date
    display_name: "Due Date"
    type: date
    required: false
    patterns:
      - '(?i)due\s*date[:\s]*(\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4})'
      - '(?i)payment\s*due[:\s]*(\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4})'
      - '(?i)pay\s*by[:\s]*(\d{1,2}[\/\-]\d{1,2}[\/\-]\d{2,4})'
    keywords:
      - "due"
      - "payment due"
      - "pay by"
    multiline: false

  - name: customer_name
    display_name: "Customer Name"
    type: string
    required: true
    patterns:
      - '(?i)(?:bill\s*to|sold\s*to|customer)[:\s]*\n?([A-Z][A-Za-z\s\.\,\&]+?)(?:\n|$)'
      - '(?i)(?:client|buyer)[:\s]*\n?([A-Z][A-Za-z\s\.\,\&]+?)(?:\n|$)'
      - '(?i)(?:name)[:\s]*\n?([A-Z][A-Za-z\s\.\,\&]+?)(?:\n|$)'
    keywords:
      - "bill to"
      - "sold to"
      - "customer"
      - "client"
      - "buyer"
    multiline: true
    validation:
      min_length: 2
      max_length: 200

  - name: customer_address
    display_name: "Customer Address"
    type: text_block
    required: false
    patterns:
      - '(?i)(?:address|bill\s*to|sold\s*to)[:\s]*\n?(.+?)(?=\n\s*\n|\n[A-Z][a-z]+:|\Z)'
    keywords:
      - "address"
      - "bill to"
      - "sold to"
    multiline: true
    validation:
      min_length: 10
      max_length: 500

  - name: vendor_name
    display_name: "Vendor Name"
    type: string
    required: false
    patterns:
      - '(?i)(?:from|vendor|seller|company)[:\s]*\n?([A-Z][A-Za-z\s\.\,\&]+?)(?:\n|$)'
    keywords:
      - "from"
      - "vendor"
      - "seller"
    multiline: false

  - name: subtotal
    display_name: "Subtotal"
    type: currency
    required: false
    patterns:
      - '(?i)sub\s*total[:\s]*[$€£¥₹]?\s*([\d,]+\.?\d*)'
      - '(?i)subtotal[:\s]*[$€£¥₹]?\s*([\d,]+\.?\d*)'
      - '(?i)amount\s*before\s*tax[:\s]*[$€£¥₹]?\s*([\d,]+\.?\d*)'
    keywords:
      - "subtotal"
      - "sub total"
      - "amount before tax"
    multiline: false

  - name: tax_amount
    display_name: "Tax Amount"
    type: currency
    required: false
    patterns:
      - '(?i)(?:tax|vat|gst)[:\s]*[$€£¥₹]?\s*([\d,]+\.?\d*)'
      - '(?i)(?:sales\s*tax)[:\s]*[$€£¥₹]?\s*([\d,]+\.?\d*)'
      - '(?i)(?:tax\s*amount)[:\s]*[$€£¥₹]?\s*([\d,]+\.?\d*)'
    keywords:
      - "tax"
      - "vat"
      - "gst"
      - "sales tax"
    multiline: false

  - name: tax_rate
    display_name: "Tax Rate"
    type: string
    required: false
    patterns:
      - '(?i)(?:tax|vat|gst)\s*(?:rate)?[:\s@]*(\d+\.?\d*)\s*%'
      - '(?i)(\d+\.?\d*)\s*%\s*(?:tax|vat|gst)'
    keywords:
      - "tax rate"
      - "vat"
      - "%"
    multiline: false

  - name: discount_amount
    display_name: "Discount Amount"
    type: currency
    required: false
    patterns:
      - '(?i)discount[:\s]*[-]?[$€£¥₹]?\s*([\d,]+\.?\d*)'
      - '(?i)(?:less|deduction)[:\s]*[$€£¥₹]?\s*([\d,]+\.?\d*)'
    keywords:
      - "discount"
      - "less"
      - "deduction"
    multiline: false

  - name: grand_total
    display_name: "Grand Total"
    type: currency
    required: true
    patterns:
      - '(?i)(?:grand\s*)?total[:\s]*[$€£¥₹]?\s*([\d,]+\.?\d*)'
      - '(?i)(?:amount\s*due|total\s*due)[:\s]*[$€£¥₹]?\s*([\d,]+\.?\d*)'
      - '(?i)(?:balance\s*due)[:\s]*[$€£¥₹]?\s*([\d,]+\.?\d*)'
      - '(?i)(?:total\s*amount)[:\s]*[$€£¥₹]?\s*([\d,]+\.?\d*)'
    keywords:
      - "total"
      - "grand total"
      - "amount due"
      - "balance due"
    multiline: false

  - name: payment_terms
    display_name: "Payment Terms"
    type: string
    required: false
    patterns:
      - '(?i)(?:payment\s*)?terms?[:\s]*([^\n]+)'
      - '(?i)net\s*(\d+)\s*days?'
      - '(?i)due\s*(?:in|within)\s*(\d+)\s*days?'
    keywords:
      - "terms"
      - "payment terms"
      - "net"
    multiline: false

  - name: purchase_order
    display_name: "Purchase Order"
    type: string
    required: false
    patterns:
      - '(?i)(?:p\.?o\.?|purchase\s*order)[:\s#]*([A-Z0-9][-A-Z0-9]{2,20})'
    keywords:
      - "po"
      - "p.o."
      - "purchase order"
    multiline: false

  - name: currency
    display_name: "Currency"
    type: string
    required: false
    patterns:
      - '(?i)currency[:\s]*([A-Z]{3})'
      - '(USD|EUR|GBP|INR|JPY|CAD|AUD)'
    keywords:
      - "currency"
      - "USD"
      - "EUR"
    multiline: false

# Line item configuration (for table extraction)
line_items:
  enabled: true
  
  # Headers that identify line item tables
  table_headers:
    - description
    - item
    - product
    - service
    - quantity
    - qty
    - unit price
    - rate
    - amount
    - total
    - price
  
  # Column mappings (header variations -> standard name)
  column_mappings:
    description:
      - "description"
      - "item"
      - "product"
      - "service"
      - "particulars"
      - "details"
    quantity:
      - "quantity"
      - "qty"
      - "units"
      - "no."
      - "count"
    unit_price:
      - "unit price"
      - "rate"
      - "price"
      - "unit cost"
      - "price/unit"
    total:
      - "total"
      - "amount"
      - "line total"
      - "ext. price"
      - "extended"

# Noise patterns to remove (headers, footers, watermarks)
noise_patterns:
  - '(?i)page\s*\d+\s*(?:of\s*\d+)?'
  - '(?i)confidential'
  - '(?i)draft'
  - '(?i)www\.[a-z]+\.[a-z]+'
  - '(?i)all\s*rights\s*reserved'
  - '(?i)©\s*\d{4}'
  - '(?i)printed\s*on'
  - '(?i)generated\s*(?:on|by)'
